# merkle-proof
Verification of compact proofs for Modified Merkle-Patricia tries(Substrate). 

Solidity version of verification is translated by the [Rust Version](https://github.com/paritytech/trie/blob/f05463150c53679c083db5cb6e181fb342ee57d8/trie-db/src/proof/verify.rs#L391).
### Brief
The proof is a sequence of the subset of nodes in the trie traversed while performing lookups on all keys. The trie nodes are listed in pre-order traversal order with some values and internal hashes omitted. In particular, values on leaf nodes, child references on extension nodes, values on branch nodes corresponding to a key in the statement, and child references on branch nodes corresponding to another node in the proof are all omitted. The proof is verified by iteratively reconstructing the trie nodes using the values proving as part of the statement and the hashes of other reconstructed nodes. Since the nodes in the proof are arranged in pre-order traversal order, the construction can be done efficiently using a stack.

### Trie node encoding specification
 Note that for the following definitions, `|` denotes concatenation

 Branch encoding:
 NodeHeader | Extra partial key length | Partial Key | Value
 `NodeHeader` is a byte such that:
 most significant two bits of `NodeHeader`: 10 if branch w/o value, 11 if branch w/ value
 least significant six bits of `NodeHeader`: if len(key) > 62, 0x3f, otherwise len(key)
 `Extra partial key length` is included if len(key) > 63 and consists of the remaining key length
 `Partial Key` is the branch's key
 `Value` is: Children Bitmap | SCALE Branch node Value | Hash(Enc(Child[i_1])) | Hash(Enc(Child[i_2])) | ... | Hash(Enc(Child[i_n]))

 Leaf encoding:
 NodeHeader | Extra partial key length | Partial Key | Value
 `NodeHeader` is a byte such that:
 most significant two bits of `NodeHeader`: 01
 least significant six bits of `NodeHeader`: if len(key) > 62, 0x3f, otherwise len(key)
 `Extra partial key length` is included if len(key) > 63 and consists of the remaining key length
 `Partial Key` is the leaf's key
 `Value` is the leaf's SCALE encoded value

### Features

1. MerkleProof.sol: verication for MMPT(16-radix) generated by Substrate trie lib.
2. Node.sol: encoding and decoding for trie node.
3. Scale.sol: SCALE codec support, `bytes` and `uint32`.
4. Hash.sol: Hash algorithm support, `keccake256` and `blake2b`.
